# Проектная работа "Веб-ларек"

https://github.com/LEGION13-alt/mesto-project-ff.git

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении

Описание карточки товара

```

export interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number | null;
}
```

Описание корзины с общей стоимостью выбранных товаров

```

export interface IBasket {
	items: string[];
	total: number;
}
```

Описание заказа для отправки на сервер

```

export interface IOrderLot {
	items: string[];
	total: number;
	payment: string;
	email: string;
	phone: string;
	address: string;
}
```

Результат отправки заказа

```

export interface IOrderResult {
	id: string;
	total: number;
}
```


Формы заказа

```

export interface IOrderForm {
	payment?: string;
	address?: string;
	phone?: string;
	email?: string;
	}

export interface IOrder extends IOrderForm {
	total?: number;
	items: string[];
	}
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы: 
- `handleResponse` - принимает ответ от сервера как параметр, и обрабатывает его,возвращая результат в формате json
 или отклоненный промис с возникшей ошибкой
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.


#### Класс `EventEmitter`
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `off` - отписка от события
- `emit` - инициализация события
- `onAll` - подписка на все события
- `offAll` - сброс всех обработчиков
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Класс `Model`
Базовая модель.Отличается от простых объектов с данными.

Методы:
- `emitChanges` - cообщает всем, что модель поменялась

### Слой данных `Model`

#### Класс `AppData`
Класс отвечает за хранение и логику работы с данными карточек товара.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- `catalog : ProductItem[]` - массив объектов карточек товара
- `preview: ProductItem | null` - карточка, выбранная для просмотра в модальном окне
- `basket: IBasket` - объект корзины(товар в корзине и общая сумма)
- `order: IOrderForm` - данные формы заказа
- `formErrors` - данные валидации формы
- `events: EventEmitter` - инициализирует события при изменении данных.

Методы:
- `setCatalog` - меняет массив товаров на переданный и эмитит событие `catalog:changed`
- `setPreview` - меняет превью на переданный товар и эмитит событие `preview:change`
- `isInBasket` - проверяет наличие товара в корзине
- `addToBasket` - добавляет товар в корзину и эмитит событие `basket:changed`
- `deleteFromBasket` - удаляет товар из корзины и эмитит событие `basket:changed`
- `clearBasket` - очищает корзину после заказа и эмитит событие `basket:changed`
- `getBasketVolume` - возвращает кол-во элементов в корзине
- `getTotal` - возвращает общую сумму заказа для вывода в окне success
- `setOrderField` - метод для установки полей формы(способ оплаты,адрес)
- `setContactsField` - метод для установки полей формы(телефон и email)
- `validateOrder` - проверяет корректность заполнения формы(способ оплаты,адрес) и эмитит событие `orderFormErrors:change`
- `validateContacts` - проверяет корректность заполнения формы контактов(email,телефон) и эмитит событие `contactsFormErrors:change`
- `getOrder` - возвращает заказ с заполненными полями
- `clearOrder` - очищает поля заказа после оформления и отправки

### Классы представления `View`
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс `Component<T>`
Базовый компонент для работы с DOM.
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

- constructor(container: HTMLElement) - принимает элемент контейнера, в который будет помещен компонент.

Методы:
- `toggleClass` - переключает класс выбранного элемента
- `setText` - устанавливает текстовое содержимое элемента
- `setDisabled` - меняет статус блокировки элемента
- `setHidden , setVisible` - скрывает/отображает элемент
- `setImage` - установливает изображение с алтернативным текстом
- `render` - возвращает корневой DOM-элемент

#### Класс `Modal`
Реализует модальное окно. 
- `constructor(selector: string, events: IEvents)` Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.

Методы:
- `open` - открывает модальное окно и эмитит `modal:open`
- `close` - закрывает и очищает содержимое модального окна,эмитит `modal:close`
- `render` - создает модальное окно с содержимым и открывает его

Поля:
- `_closeButton` - кнопка закрытия модального окна
- `_content` - содержимое модального окна

Сеттеры:
- `content` - меняет содержимое модального окна

#### Класс `Basket`
Отвечает за отображение карточки элементов в корзине.
Поля класса содержат элементы разметки элементов корзины.Сеттеры меняют содержимое контейнера на полученное.
`constructor (container: HTMLElement, protected events: EventEmitter)` - принимает контейнер и брокер событий

Поля:
- `_list` - отображает элементы карточек в корзине
- `_total` - элемент общей суммы товаров в корзине
- `_button` - элемент кнопки оформления заказа в корзине

Сеттеры:
- `items` -  меняет/получает отправленные товары в корзине
- `total` -  меняет общую стоимость товаров в корзине

Методы:
- `toggleButton` - меняет состояние активности кнопки 

#### Класс `Card`
Отвечает за отображение карточки товара, задавая в ней данные названия,описания,категории,изображения,стоимости.\
В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки.Сеттеры меняют содержимое контейнера на полученное.

Конструктор, кроме темплейта принимает экземпляр `ICardActions` колбэк для вызова при клике.

Поля:

- `_title` - элемент заголовка карточки
- `_description` - элемент описания карточки
- `_category` - элемент категории карточки
- `_image` - элемент картинки карточки
- `_price` - элемент стоимости карточки
- `_button`- элемент кнопки карточки

Сеттеры:
- `id` - принимает и задает id карточки на полученную
- `title` - меняет заголовок
- `price` - меняет стоимость
- `category` - меняет категорию
- `image` - меняет изображение
- `description `- меняет описание
- `button` - устанавливает текст на кнопке

#### Класс `CardInBasket`
Отвечает за отображение карточки товара в корзине, задавая в ней данные названия,стоимости,кнопки удаления.

Поля:
- `_title` - элемент заголовка карточки
- `_price` - элемент стоимости карточки
- `_index` - элемент нумерации карточки
- `_deleteCardButton` - элемент кнопки удаления карточки из корзины

Сеттеры:
- `title` - меняет заголовок
- `price` - меняет стоимость
- `index` - устанавливает нумерацию карточки в корзине

#### Класс `OrderForm`
Отвечает за отображение данных адреса и способов оплаты полученных от пользователя.
`constructor(container: HTMLFormElement, events: IEvents)` - принимает контейнер и брокер событий

Поля:
- `_buttonOnline`, `_buttonCash`  - отображают  кнопки выбора способа оплаты
- `_address` - элемент инпута адреса

Сеттеры:
- `payment` - меняет классы кнопок в зависимости от выбранного способа оплаты
- `address` -  меняет содержимое поля адреса в форме

#### Класс `ContactsForm`
Отвечает за отображение данных email и номера телефона полученных от пользователя.
`constructor(container: HTMLFormElement, events: IEvents)` - принимает контейнер и брокер событий

Поля:
- `_email` - инпут email
- `_phone` - инпут номера телефона

Сеттеры:
- `email` - меняет содержимое поля email в форме
- `phone` - меняет содержимое поля phone в форме

#### Класс `Page`
Отвечает за отображение главной страницы со счетчиком карточек товара в корзине.
`constructor(container: HTMLFormElement, events: IEvents)` - принимает контейнер и брокер событий.

Поля:
- `_counter` - элемент счетчика на странице
- `_catalog` - элемент каталога на странице
- `_wrapper` - элемент обертки на странице
- `_basket` - элемент корзины на странице, эмитит `basket:open`

Сеттеры:
- `counter` - меняет содержимое счетчика на полученное значение
- `catalog` - меняет содержмое каталога на полученные значения
- `locked` - меняет обертку на полученное значение


#### Класс `Succes`
Отвечает за отображение модального окна с подтверждением закза.
`constructor(container: HTMLElement,actions: ISuccessActions)` - принимает контейнер и брокер событий.

- `_close` - кнопка закрытия окна,переход на главную страницу
- `_total` - элемент с суммой заказа

Сеттеры:
`total` - меняет содержимое элемента с итоговой суммой заказа

### Слой коммуникации

#### Класс `LarekAPI`
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
`constructor(cdn: string, baseUrl: string, options?: RequestInit)` - принимает url сервера с контентом, url запросов и опции для запросов.

Поля:
`cdn` - url сервера с контентом

Методы:
`getProductList` - возвращает массив карточек продуктов с сервера по id
`createOrder` - отправляет заказ на сервер и возвращает результат

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*

`catalog:changed`- изменение массива товаров каталога
`preview:change` - изменение открываемого в модальном окне товара
`basket:changed` - изменение списка товаров корзины
`orderFormErrors:change`,`contactsFormErrors:change` - изменение в списке ошибок валидации форм 
`/^order\..*:change/`,`/^contacts\..*:change/` - изменение полей в форме

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

- `card:select` - выбор карточки
- `basket:open` - открытие окна корзины
- `order:open` - открытие окна оформления заказа
- `order:submit` - открытие окна контактов
- `contacts:submit` - открытие окна подтверждения заказа
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна

